// NPC Script for handling mounts like Dragon, Madogear, and Wolf.

izlude,88,148,5	script	Mount Manager	-1,{	
	callsub OnClick;
	end;

	OnInit:
		callfunc("customizeNPCSprite", 20388, 0, 0, 0, 0, 0, 0, 0, 53, 16);
		end;

	OnClick:
		set .@npc_name$, "^a39f00[ Litzy ]^000000";
		set .@dragon$, "^388E3CDragon^000000"; set .@madogear$, "^ff6800Madogear^000000"; set .@wolf$, "^0288D1Wolf^000000";
		set .@knight_id, roclass(EAJ_KNIGHT); set .@blacksmith_id, roclass(EAJ_BLACKSMITH); set .@hunter_id, roclass(EAJ_HUNTER);
		// Start of dialogue
		cutin "litzy", 2;
		mes .@npc_name$;
		mes "Hey there~!";
		mes "I'm Litzy, should you need guidance for";
		mes .@dragon$ + ", " +.@madogear$+ ", and " +.@wolf$+ " mounts,";
		mes "then I'm here to assist you.";
		next;
		set .@mount_select, select("Can you help me train a " +.@dragon$+ "?:Can you build a "+.@madogear$+"?:Can you call a lone " +.@wolf$+ "?:Cancel");
		switch(.@mount_select){
			// Check Halter lead first.
			if (ismounting() && !getskilllv("NC_MADOLICENCE")){
					emotion ET_WRAP;
					mes .@npc_name$;
					mes "Please dismount from your ^000fff'Halter Lead'^000000 before acquiring a new mount here.";
					close3;
				}
			
			case 1: //Dragon Mounts
				set .@dragon_color, 1;

				if (!rk_version){
					emotion ET_STARE_ABOUT;
					mes .@npc_name$;
					mes "You should be a ^F57C00Rune Knight^000000 or";
					mes "^F44336Dragon Knight^000000 to get a " +.@dragon$+ ".";
					mes "Please find <NAVI>Celestia<INFO>izlude,88,128,0,000,0</INFO></NAVI>";
					mes "to change Job Costumes before getting a " +.@dragon$+ ".";
					close3;
				}

				if (getskilllv("KN_CAVALIERMASTERY") != 5){
					mes .@npc_name$;
					mes "I'm sorry, you need to have";
					mes "<URL>Level 5 Cavalry Masyery<INFO>https://irowiki.org/classic/Cavalier_Mastery</INFO></URL>";
					emotion ET_SORRY;
					close3;
				}

				// Intro speech for special dragons
				if (rk_version == 2 && !checkdragon()){
					emotion ET_BIGTHROB;
					mes .@npc_name$;
					mes "Oh!, the version of your costume";
					mes "allows you to choose a";
					mes "^8F00FFMystically Colored Dragon^000000~";
					next;
				}

				// If player already has a colored dragon, then wants to change it
				if (rk_version == 2 && checkdragon()){
					mes .@npc_name$;
					mes "Do you want change your " +.@dragon$+ "?";
					next;
					switch(select("Yes:No")){
						case 1:
							setdragon 0;
							break;
						case 2:
							callfunc("exitSpeech", .@npc_name$, .@knight_id);
							close3;
							return;
					}
				}

				// Choose color of your dragon
				if (rk_version == 2){
					mes .@npc_name$;
					mes "What color do you want for your";
					mes .@dragon$+ "?";
					next;
					switch(select("^388E3CGreen (Default)^000000:^4E342EBrown^000000:^455A64Gray^000000:^0288D1Blue^000000:^D32F2FRed^000000")){
						case 1:
							break;
						case 2:
							set .@dragon_color, 2;
							break;
						case 3:
							set .@dragon_color, 3;
							break;
						case 4:
							set .@dragon_color, 4;
							break;
						case 5:
							set .@dragon_color, 5;
							break;
					}
				}


				if ((checkdragon() && rk_version != 2) || (rk_version == 3 && checkriding())){
					emotion ET_OK;
					mes .@npc_name$;
					mes "You already have a " +.@dragon$+ ".";
					mes "Remember to give it head pats regularly~";
					close3;
				}


				if (!getskilllv("RK_DRAGONTRAINING")) {
					mes .@npc_name$;
					mes "Seems like you haven't learned";
					mes "'^388E3CDragon Training^000000' yet.";
					mes "Let me show you...";
					mes "<URL>How to train a dragon~<INFO>https://www.youtube.com/watch?v=ZDyEERuK31Y</INFO></URL>";
					next;
					progressbar "ffff00", 3;
					specialeffect 670, SELF;
					soundeffect "dragonfear.wav", 0;
					next;
					mes "You learned 'Dragon Training'.";
					mes "You got a " +.@dragon$+ ".";
					skill "RK_DRAGONTRAINING", 5, SKILL_PERM_GRANT;
					next;
					specialeffect2 1218, SELF;
					soundeffect "dragon_h.wav", 0;
					callfunc("exitSpeech", .@npc_name$, .@knight_id);
				} else if (getskilllv("RK_DRAGONTRAINING")){
					specialeffect2 1803, SELF;
					soundeffect "dragon_h.wav", 0;
					callfunc("exitSpeech", .@npc_name$, .@knight_id);
				}

				// For rk_version 3, use pecopeco only
				if (rk_version == 3) {
					setriding 1;
					close3;
				}
				setdragon .@dragon_color;	
				close3;

			case 2: //Madogear Mounts
				if (!mado_compatible){
					emotion ET_STARE_ABOUT;
					mes .@npc_name$;
					mes "You should be a ^F57C00Mechanic^000000 or";
					mes "^F44336Meister^000000 to get a " +.@madogear$+ ".";
					mes "Please find <NAVI>Celestia<INFO>izlude,88,128,0,000,0</INFO></NAVI>";
					mes "to change Job Costumes before getting a " +.@madogear$+ ".";
					close3;
				}

				if (!getskilllv("NC_MADOLICENCE")) {
					mes .@npc_name$;
					mes "Seems like you haven't gotten";
					mes "'^388E3CMagic License^000000' yet.";
					mes "Let me show you...";
					mes "<URL>How to build a Madogear~<INFO>https://www.youtube.com/watch?v=h9nB5ZzbSO8</INFO></URL>";
					next;
					progressbar "ffff00", 3;
					specialeffect 1854, SELF;
					
					next;
					mes "You got 'Magic Gear License'.";
					mes "You got a " +.@madogear$+ ".";
					skill "NC_MADOLICENCE", 5, SKILL_PERM_GRANT;
					next;
				}

				if (ismounting()) {
					mes .@npc_name$;
					mes "Looks like you¡¯ve got your "+.@madogear$+" all set up!";
					next;
					callfunc("exitSpeech", .@npc_name$, .@blacksmith_id, .@madogear$);
				}  else if(!ismounting()) {
					setmounting();
					specialeffect2 1835, SELF;
					soundeffect "CD_FRAMEN.wav", 0;
					callfunc("exitSpeech", .@npc_name$, .@blacksmith_id, .@madogear$);
				}

				// Give special mount item
				if(countitem(68000) < 1) {
					next;
					mes .@npc_name$;
					mes "Take this exclusive item";
					mes "to mount or unmount anytime.";
					mes "Don't you lose it~!";
					getnameditem 68000, getcharid(0);
				}
				close3;

			case 3: // Wolf Mounts
				close3;
				break;
		}
		

}

function	script	exitSpeech	{
	switch(getarg(1)){
		mes getarg(0); //NPC name
		case 7: //Knight Class
			emotion ET_GOODBOY;
			mes "Keep it nourished and happy, and it will illuminate your path, even in the darkest dungeons~ ^_^";
			break;
			
		case 10: //Blacksmith Class
			emotion ET_SPARK;
			mes "This "+getarg(2)+" is more ";
			mes "than a machine;";
			mes "it's your steadfast companion. ";
			mes "Together, you can explore anything~ ^_^";
			break;
	}
	return;
}