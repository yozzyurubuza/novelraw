// NPC Script for handling mounts like Dragon, Madogear, and Wolf.

izlude,88,148,5	script	Mount Manager	-1,{	
	callsub OnClick;
	end;

	OnInit:
		callfunc("customizeNPCSprite", 20388, 0, 0, 0, 0, 0, 0, 0, 53, 16);
		end;

	OnClick:
		set .@npc_name$, "^a39f00[ Litzy ]^000000";
		set .@dragon$, "^388E3CDragon^000000"; set .@madogear$, "^FF8F00Madogear^000000"; set .@wolf$, "^0288D1Wolf^000000";
		// Start of dialogue
		cutin "litzy", 2;
		mes .@npc_name$;
		mes "Hey there~!";
		mes "I'm Litzy, should you need guidance for";
		mes .@dragon$ + ", " +.@madogear$+ ", and " +.@wolf$+ " mounts,";
		mes "then I'm here to assist you.";
		next;
		set .@mount_select, select("Can you help me train a " +.@dragon$+ "?:Can you build a "+.@madogear$+"?:Can you call a lone " +.@wolf$+ "?:Cancel");
		switch(.@mount_select){
			case 1:
				set .@dragon_color, 1;

				if (!rk_version){
					emotion ET_STARE_ABOUT;
					mes .@npc_name$;
					mes "You should be a ^F57C00Rune Knight^000000 or";
					mes "^F44336Dragon Knight^000000 to get a " +.@dragon$+ ".";
					mes "Please find <NAVI>Celestia<INFO>izlude,88,128,0,000,0</INFO></NAVI>";
					mes "to change Job Costumes before getting a " +.@dragon$+ ".";
					close3;
				}

				if (getskilllv("KN_CAVALIERMASTERY") != 5){
					mes .@npc_name$;
					mes "I'm sorry, you need to have";
					mes "<URL>Level 5 Cavalry Masyery<INFO>https://irowiki.org/classic/Cavalier_Mastery</INFO></URL>";
					emotion ET_SORRY;
					close3;
				}

				// Intro speech for special dragons
				if (rk_version == 2 && !checkdragon()){
					emotion ET_BIGTHROB;
					mes .@npc_name$;
					mes "Oh!, the version of your costume";
					mes "allows you to choose a";
					mes "^8F00FFMystically Colored Dragon^000000~";
					next;
				}

				// If player already has a colored dragon, then wants to change it
				if (rk_version == 2 && checkdragon()){
					mes .@npc_name$;
					mes "Do you want change your " +.@dragon$+ "?";
					next;
					switch(select("Yes:No")){
						case 1:
							setdragon 0;
							break;
						case 2:
							callfunc ("exitSpeech", .@npc_name$);
							close3;
							return;
					}
				}

				// Choose color of your dragon
				if (rk_version == 2){
					mes .@npc_name$;
					mes "What color do you want for your";
					mes .@dragon$+ "?";
					next;
					switch(select("^388E3CGreen (Default)^000000:^4E342EBrown^000000:^455A64Gray^000000:^0288D1Blue^000000:^D32F2FRed^000000")){
						case 1:
							break;
						case 2:
							set .@dragon_color, 2;
							break;
						case 3:
							set .@dragon_color, 3;
							break;
						case 4:
							set .@dragon_color, 4;
							break;
						case 5:
							set .@dragon_color, 5;
							break;
					}
				}


				if ((checkdragon() && rk_version != 2) || (rk_version == 3 && checkriding())){
					emotion ET_OK;
					mes .@npc_name$;
					mes "You already have a " +.@dragon$+ ".";
					mes "Remember to give it head pats regularly~";
					close3;
				}


				if (!getskilllv("RK_DRAGONTRAINING")) {
					mes .@npc_name$;
					mes "Seems like you haven't learned";
					mes "'^388E3CDragon Training^000000' yet.";
					mes "Let me show you...";
					mes "<URL>How to train a dragon~<INFO>https://www.youtube.com/watch?v=ZDyEERuK31Y</INFO></URL>";
					next;
					progressbar "ffff00", 3;
					specialeffect 670, SELF;
					soundeffect "dragonfear.wav", 0;
					next;
					mes "You learned 'Dragon Training'.";
					mes "You got a " +.@dragon$+ ".";
					skill "RK_DRAGONTRAINING", 5, SKILL_PERM_GRANT;
					next;
					specialeffect2 1218, SELF;
					soundeffect "dragon_h.wav", 0;
					callfunc ("exitSpeech", .@npc_name$);
				} else if (getskilllv("RK_DRAGONTRAINING")){
					specialeffect2 1803, SELF;
					soundeffect "dragon_h.wav", 0;
					callfunc ("exitSpeech", .@npc_name$);
				}

				// For rk_version 3, use pecopeco only
				if (rk_version == 3){
					setriding 1;
					close3;
				}
				setdragon .@dragon_color;	
				close3;
		}
		


}

function	script	exitSpeech	{
	emotion ET_GOODBOY;
	mes getarg(0);
	mes "Keep it nourished and happy, and it will illuminate your path, even in the darkest dungeons~ ^_^";
	return;
}